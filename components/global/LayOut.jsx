import Head from 'next/head';
import NavBar from './NavBar';
import React, { useEffect } from 'react';
import { getAuth } from "firebase/auth";
import { useAuthState } from 'react-firebase-hooks/auth';
import { logOutExternal } from '../Auth/logOutExternal';
import LogInModal from '../Auth/LogInModal';
import { useAppSelector , useAppDispatch } from '../../redux/hooks';
import { setLogInFlag } from '../../redux/features/actions/auth';

const Layout = ({ children }) => {
  const dispatch = useAppDispatch()
  const { logInFlag } = useAppSelector(state => state.auth)
  // const analytics = getAnalytics(app); // Initialize Analytics and get a reference to the service
  const auth = getAuth(); // instance of auth method
  const [user, loading] = useAuthState(auth); // user data
  const logOut = () => { // runs the external log out function
    logOutExternal(auth)
  };
  useEffect(() => {
    setTimeout(() => {
      if (!logInFlag) {
        dispatch(setLogInFlag(true));
      }
    },90000)
  },[])

  return (
    <div className='w-screen h-screen flex flex-col bg-dokuso-white'>
      <Head>
        <title>Dokus≈ç</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href=""/>
      </Head>
      <NavBar logOut={logOut} user={user}/>
      <main className='flex flex-col flex-auto p-0 m-0 overflow-auto scrollbar'>
        {children}
        {logInFlag && <LogInModal/>}
      </main>
    </div>
  )
}

export default Layout;